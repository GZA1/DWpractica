{% extends 'base.html.twig' %}
{% block title %} Cesta de Compra {% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{asset('styles/style-shared.css')}}">
    <link rel="stylesheet" href="{{asset('styles/style-cesta.css')}}">
{% endblock %}
{% block javascripts %}


{% endblock %}

{% block body %}
    {% if msg is defined and msg != null %}
        {% if tipoMessage == 1 %}
            <div id="notificacion" style="width: 100%; height: 20px; color: #2fbf2f; background-color: #1e1e15;padding: 10px;">{{msg}}</div>

        {% endif %}

        {% if tipoMessage == 0 %}
            <div id="notificacion" style="width: 100%; height: 20px; color: #ff7f7f; background-color: #1e1e15;padding: 10px;">{{msg}}</div>
        {% endif %}
    {% endif %}

    {{ include('nav/nav.html.twig')}}


    {# {% set arrayProductos = '' %}

    {% if app.session.get('cesta') is defined %}
        {% set numeroUnidadesTipo = '' %}
        {% for prod in productosCesta %}
            {% set contador = 0 %}
            {% for unit in app.session.get('cesta').unidades %}
                {% if unit.producto == prod %}
                    {% set contador  = contador + 1 %}
                {% endif %}
            {% endfor %}
        {% set numeroUnidadesTipo = numeroUnidadesTipo|merge([contador]) %}

        {% endfor %}
        {% for prod in productosCesta %}

            <div class="producto-container flex_rows borde-abajo" name="{{prod.nombre}}">
                <div class="flex_rows separador-horizontal">
                    <div class="producto-img">
                        <a href=""><img height="100%" src=".{{asset(prod.photo)}}"></a>
                    </div>
                    <div class="producto-contenido">
                        <ul>
                            <li>
                                <a class="nombre-componente" href="{{path('producto', {'producto': '{{prod.id}}'})}}">{{prod.nombre}}</a>
                            </li>
                            <li>
                                <span class="categoria-componente">{{prod.categoria}}</span>
                            </li>
                            <li>
                                <span class="en-stock">En stock</span>
                            </li>
                            <li>
                                <span class="envio">Envío gratis
                                </span>disponible
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="producto-precio">
                    {{prod.precio}}
                </div>
                <div class="producto-cantidad">
                    <input class="producto-cantidad-input" min="0" onchange="calcValue()" step="1" type="number" value="{{numeroUnidadesTipo[loop.index]}}">
                </div>
            </div>
        {% endfor %}

    {% else %}

        <div style="max-height: auto; min-height: 12vh;"> No ha añadido nada a su cesta aún</div>


    {% endif %} #}
        






        

    <div style="height: 10vh; min-height: 70px; visibility: hidden"></div>
    <div class="cesta_main_container flex_cols">
        <h2 id="titulo-cesta">Cesta de la compra</h2>

        {% if app.session.get('cesta') %}

        <div class="flex_rows borde-abajo">
            <div class="separador-horizontal"></div>
            <div id="precio">Precio</div>
            <div id="cantidad">Cantidad</div>
        </div>

            {% set prods = '' %}
            {% for unidad in cesta.unidades %}
                {% if prods is empty %}
                    {% set prods = unidad.producto %}                    
                {% else %}
                    {% set prods = prods|merge([unidad.producto]) %}
                {% endif %}

            {% endfor %}
            
            {% for unidad in cesta.unidades %}
                {% set prod = unidad.producto %}
                {% set cat = unidad.producto.categoria %}
                {% set nombre = '' %}

                <div class="producto-container flex_rows borde-abajo" name="{{unidad.producto.nombre}}">
                    <div class="flex_rows separador-horizontal">
                        <div class="producto-img">
                            <a href="{{path('producto', {'producto': prod.id})}}"><img height="100%" src="{{asset(prod.photo)}}"></a>
                        </div>
                        <div class="producto-contenido">
                            <ul>
                                <li>
                                    <a class="nombre-componente" href="{{path('producto', {'producto': prod.id})}}">{{prod.nombre}}-{{prod.marca}}-{{prod.modelo}}</a>
                                </li>
                                <li>
                                    <span class="categoria-componente">{{nombre}}</span>
                                </li>

                                {% if unidad.vendido == false %}

                                <li>
                                    <span class="en-stock">En stock</span>
                                </li>

                                {% else %}

                                <li>
                                    <span class="sin-stock">Sin stock</span>
                                </li>

                                {% endif %}

                                {% set precioAct = prod.precio %}

                                {% if unidad.enviar %}

                                    {% set precioAct = prod.precio + prod.precio * 1/20 %}

                                <li>
                                    <span class="envio">Coste de envío:
                                    </span>
                                    <span class="coste-envio">{{prod.precio * 1/20}}€</span>
                                </li>

                                {% endif %}

                            </ul>
                        </div>
                    </div>
                    <div
                        class="producto-precio">{{precioAct}}
                    </div>
                    <div class="producto-cantidad">
                        <input class="producto-cantidad-input" type="text" value="1">
                    </div>
                </div>

            {% endfor %}



            <div class="flex_rows"> <div class="separador-horizontal-80"></div>
            <div id="subtotal">
                Subtotal:
                <input class="sombreado" id="subtotal-resultado" readonly type="text" value="{{cesta.costeTotal}}">
            </div>
        </div>
        <br>
        <div class="flex_rows">
            <div class="separador-horizontal-60"></div>
            <a class="sombreado" href="{{path('cancelarCesta')}}" id="boton-comprar" style="background-color: red; text-decoration: none">Cancelar pedido</a>
            <div class="sombreado" href="" id="boton-comprar" onclick="tramitarPedido()">Tramitar pedido</div>
        </div>
        <br>
        <div class="flex_rows">
            <p id="resumen-pedido-tramitado"></p>
        </div>

        {% else %}

        <div id="cesta-vacia">Cesta vacía </div>

        {% endif %}

    </div>



{% endblock %}

{% block footer %}

    {{ include('footer/footer.html.twig')}}

{% endblock %}
